+import('../../bower_components/core-ajax/core-ajax.html')
+import('./garcon-nav.html')
+import('./garcon-state.html')
+import('./garcon-video-player.html')

+polymer-element
  core-ajax(
    auto
    url="/api/shows"
    response="{{ shows }}"
    handleAs="json" )

  garcon-state#state_show(key="show" value="{{ state_show }}")
  garcon-state#state_showVideo(key="playingVideo" value="{{ state_showVideo }}")

  .app-bar(on-click="{{ toggleNav }}")
    .app-bar__settings.t-icon-control.l-float-l.l-margin-r2
      | &#xe53e;
    .app-bar__title
      | {{ state_show || 'All' }}

  .show-player-container(class="{{ !!state_showVideo ? 's-show-video' : '' }}")

    template(if="{{ state_showVideo }}")
      garcon-video-player(
        videoSrc="{{ 'http://'+videoServerHostName+':1337/'+state_showVideo.file }}")

    .shows.l-padding-h2
      template(repeat="{{ show in shows | filterShows(state_show) }}")
        .show
          h3.show__name.l-padding-b4.l-padding-h3.l-padding-t8
            | {{ show.name }}

          .videos.b-list.b-list--card
            template(repeat="{{ video in show.videos }}")
              .video.b-list__item.b-list__item--selectable(
                on-click="{{showVideo}}"
                class="{{ {'s-playing':video === state_showVideo} | tokenList }}")
                a.video__play-button.l-float-r.t-icon-control
                  | &#xe5bb;

                | {{ video.episode }}

                span.video__season.l-margin-h2
                  | season {{ video.season }}


  .content-overlay(on-click="{{ toggleNav }}")
  garcon-nav(on-selection="{{ toggleNav }}")
